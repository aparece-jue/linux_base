# 命令

- [命令](#命令)
  - [监测程序](#监测程序)
    - [ps](#ps)
      - [输出属性](#输出属性)
        - [STAT的参数](#stat的参数)
      - [ps的Unix风格参数](#ps的unix风格参数)
      - [ps的BSD风格参数](#ps的bsd风格参数)
      - [ps的GNU风格参数](#ps的gnu风格参数)
    - [top](#top)
      - [cpu概要信息](#cpu概要信息)
      - [top的属性](#top的属性)
      - [linux的进程信号](#linux的进程信号)
      - [top的命令](#top的命令)
    - [kill](#kill)
    - [killall](#killall)
  - [监测磁盘空间](#监测磁盘空间)
    - [mount](#mount)
      - [mount的参数](#mount的参数)
      - [-o的额外选项](#-o的额外选项)
    - [umount](#umount)
    - [df](#df)
      - [df的参数](#df的参数)
    - [du](#du)
      - [du的参数](#du的参数)
  - [处理数据文件](#处理数据文件)
    - [sort](#sort)
      - [sort的参数](#sort的参数)
    - [grep](#grep)
      - [grep的参数](#grep的参数)
    - [gzip](#gzip)
    - [tar](#tar)
      - [tar的参数](#tar的参数)

## 监测程序

### ps

- 默认只显示**运行在当前控制台**下的**属于当前用户**的进程。
- 参数列表使用,分隔
- 只能显示某个特定时间点的信息

#### 输出属性

| 属性 | 描述 |
| - | - |
| UID |启动进程的用户id|
|PID|进程id|
|PPID|父进程的进程id|
|C|进程生命周期中的CPU利用率|
|STIME|进程启动时的系统时间|
|TTY|进程启动时的终端设备|
|TIME|运行进程需要的累计CPU时间|
|CMD|进程名|
|F|内核分配给进程的系统标记|
|S|进程的状态(O表示正在运行;S表示休眠;R表示可运行,等待运行;Z表示僵尸状态，进程已结束但父进程已不存在;T表示停止)|
|PRI|进程的优先级(越大的数字代表越低的优先级)|
|NI|谦让度值用来参与决定优先级|
|ADDR|进程的内存地址|
|SZ|假如进程被换出，所需的交换空间的大致大小|
|WCHAN|进程休眠的内核函数的地址|
|VSZ|进程在内存中的大小，单位为KB|
|RSS|进程在未换出时占用的物理内存|
|STAT|代表当前进程状态的双字符状态码|

##### STAT的参数

- 第一个参数表示进程的状态
- 第二个参数进一步说明进程的状态
  - '<': 该进程运行在高优先级上
  - 'N': 该进程运行在低优先级上
  - 'L': 该进程有页面锁定在内存中
  - 's': 该进程是控制进程
  - 'l': 该进程是多线程的
  - '+': 该进程运行在前台

#### ps的Unix风格参数

| 参数 | 描述 |
| - | - |
| -A,-e | 显示所有进程 |
| -N | 显示与指定参数不符的所有进程，与其他筛选参数一起使用 |
| -a | 显示除控制进程和无终端进程外的所有进程 |
| -d | 显示除控制进程外的所有进程 |
| -C *cmdlist* | 显示包含在*cmdlist*列表中的进程，cmd是进程名 |
| -G *grplist* | 显示组id在*grplist*列表中的进程 |
| -U *userlist* | 显示属主的用户id在*userlist*列表中的进程 |
| -g *grplist* | 显示会话id或组id在*grplist*列表中的进程 |
| -p *pidlist* | 显示pid在*pidlist*列表中的进程 |
| -o,-O *format*| 格式化输出如pid,ppid，cmd,gid,-O还显示默认输出 |
| -s *sesslist*| 显示会话id在*sesslist*列表中的进程信息，如果不加，默认显示当前终端的会话ID相关的进程信息 |
| -t *ttylist*| 显示终端id在*ttylist*列表中的进程 |
| -u *userlist* | 显示有效用户id在*userlist*中的进程 |
| -f | 显示完整格式的输出 |
| -F | 相对-f,显示更多额外输出(内存大小，驻留集大小，运行的处理器编号) |
| -M | 显示进程的安全信息，是否受到selinux策略的约束 |
| -c | 显示进程的额外调度器信息 |
| -j | 显示任务信息，进程组id和会话id(pgid,sid) |
| -l | 显示长列表，相对与-F还显示了进程状态与会话领袖属性 |
| -y | 不显示进程运行状态标记，与ls连用 |
| -Z | 显示安全标签信息 |
| -H | 用层级格式显示进程，可使用pstree |
| -n *namelist* | 输出wchan列 |
| -w | 采用宽输出模式，不显示宽度显示 |
| -L | 显示进程中的线程 |
| -V | 显示ps版本号 |

#### ps的BSD风格参数

| 参数 | 描述 |
| - | - |
|T|显示当前终端关联的进程|
|a|显示跟任意终端关联的所有进程|
|g|显示所有进程，包括控制进程|
|r|仅显示运行中的进程|
|x|显示所有进程，包括未分配任何终端的进程|
|U userlist|显示userlist中的用户所有的进程|
|p pidlist|显示pid在pidlist中的进程|
|t ttylist|显示ttylist中终端所关联的进程|
|o,O format|格式化输出如pid,ppid，cmd,gid,O还显示默认输出|
|X|按linux i386寄存器格式输出(STACKP,ESP,EIP,TMOUT,ALARM)|
|z|输出安全信息|
|j|显示任务信息|
|l|长格式输出(F,PRI,NI,VSZ,RSS,WCHAN,STAT)|
|s|采用信号格式输出( PENDING,BLOCKED,IGNORED,AUGHT)|
|u|采用基于用户的格式显示(USER,%CPU,%MEM,VSZ,RSS)|
|v|采用虚拟内存格式显示(STAT,MAJFL,TRS,DRS,RSS,%MEM)|
|N|定义在wchan中使用的值|
|O order|定义显示信息列的顺序|
|S|将数值信息从子进程加到父进程上，如CPU和内存的使用情况|
|c|显示真实的命令名称(用启动进程的程序名称)|
|e|显示命令使用的环境变量|
|f|按分层格式来显示进程|
|h|不显示头信息|
|k sort|指定用以将输出排序的列，[+/-]key,[+/-]key，+为升序,-为降序|
|n|和wchan信息一起显示，用数值表示uid与gid|
|w|宽输出|
|H|将线程按进程来显示|
|m|在进程后显示线程(MAJFLT,MINFLT,TRS,DRS,SIZE,SWAP,RSS,SHRD,LIB,DT)|
|L|列出所有格式指定符|
|V|版本号|

#### ps的GNU风格参数

| 参数 | 描述 |
| - | - |
|--deselect|显示所有进程，除了命令行中列出的进程|
|--Group grplist|组id在grplist中的进程|
|--group grplist|有效组id在grplist中的进程|
|--User userlist|用户id在userlist中的进程|
|--user userlist|显示有效uid在userlist中的进程|
|--pid pidlist|显示pid在pidlist中的进程|
|--ppid ppidlist|显示父pid在ppidlist中的进程|
|--sid sidlist|显示sid在sidlist中的进程|
|--tty ttylist|显示tty在ttylist中的进程|
|--format format|仅显示由format指定的列|
|--context|显示额外安全信息|
|--cumulative|包含已停止的子进程的信息|
|--forest|用层级结构显示出进程和父进程之间的关系|
|--headers|在每页输出中都显示列的头|
|--no-headers|不显示列的头|
|--cols n,--columns n|设置屏幕宽度|
|--lines n|设置屏幕高度设为n行|
|--row n|将屏幕高度设置为n排|
|--sort order|指定将输出按哪列排序|
|--width n|将屏幕宽度设置为n列|
|--help|显示帮助信息|
|--info|显示调试信息|
|--version|显示版本号|

### top

- 实时显示进程信息，默认按照%CPU对进程排序
- 可以加-d (s)来修改轮询时间
- 显示信息
  - 系统的概况:当前时间，系统的运行时间，登陆的用户数以及系统的平均负载(分别是最近1分钟，最近5分钟，最近15分钟的平均负载)、
    - 通常负载值达到2，说明系统比较繁忙
  - 进程的概要信息:有多少进程处在运行，休眠，停止或是僵化状态。
  - CPU的概要信息，根据进程的属主(用户还是系统)和进程的状态(运行，空闲还是等待)将CPU利用率分成几类输出

  - 系统的物理内存，总共有多少，当前用了多少，还有多少空闲。
  - 系统的交换空间

#### cpu概要信息

|字段|含义|
|-|-|
|us|用户态CPU时间，用户空间程序执行的时间比例|
|sy|内核态CPU时间，系统内核执行的时间比例|
|ni|表示用于nice操作的进程(通过调整优先级来影响进程调度的CPU时间)|
|id|CPU空闲时间，CPU处于空闲状态的时间比例|
|wa|CPU等待时间，CPU扥带I/O操作完成的时间比例|
|hi|硬中断时间，处理硬件终端所消耗的时间比例|
|si|软中断时间，表示处理软件中断所消耗的时间比例|
|st|被偷取时间，被虚拟化环境偷取的时间比例|

#### top的属性

|属性|描述|
|-|-|
|PR|进程的优先级|
|NI|进程的谦让值|
|VIRT|进程占用的虚拟内存总量|
|RES|进程占用的物理内存总量|
|SHR|进程和其他进程共享的内存总量|
|S|进程的状态|
|%CPU|进程使用CPU的时间比例|
|%MEN|进程使用的内存占可用内存的比例|
|TIME+|自进程启动到目前为止的CPU时间总量|

#### linux的进程信号

|信号|名称|描述|
|-|-|-|
|1|HUP|挂起|
|2|INT|中断|
|3|QUIT|结束运行|
|9|KILL|无条件终止|
|11|SEGV|段错误|
|15|TERM|尽可能终止|
|17|STOP|无条件停止运行，但不终止|
|18|TSTP|停止或暂停，但继续在后台运行|
|19|CONT|在STOP或TSTP之后回复执行|

#### top的命令

|命令|含义|
|-|-|
|c|显示完整的命令行及参数|
|H|显示线程|
|f|添加或删除列以显示特定信息|
|o|更改排序字段|
|P|按cpu使用率进行排序|
|M|按内存使用量进行排序|
|T|按运行时间排序|
|u userlist|仅显示指定用户的进程|
|p pid|仅显示指定pid的进程|
|z|彩色显示|
|b|显示平均负责和任务信息|
|i|不显示任何闲置或僵化进程|
|n 次数|设置显示的更新次数|

### kill

- 进程之间使用信号来通信。进程的信号是预定好的一个消息，进程能识别它并决定忽略还是做出反应。
- kill命令可以通过pid给进程发信号，默认情况下，会向命令行中列出的全部pid发送一个TERM信号，只能使用pid不能使用命令名。TERM让进程可能的话停止运行。
- 可以通过使用-s参数来指定要发送的信号类型而不是通过信号编号
- 发送进程信号时必须是进程的属主或为root

### killall

- 支持通过命令名而不是pid结束进程，支持通配符。

## 监测磁盘空间

### mount

- 使用新的存储媒体之前，需要把它放到虚拟目录下，这项工作称为挂载。
- 默认会输出当前系统上挂载的设备列表
- 输出信息
  - 媒体的设备文件名，媒体挂载到虚拟目录的挂载点
  - 文件系统的类型
  - 已挂载媒体的访问状态
- 挂载命令:mount -t type device directory
  - type指定磁盘被格式化的文件系统类型媒体设备挂载到了虚拟目录后，root用户有了对该设备的所有访问权限，而其他用户的访问会被限制，可以通过目录权限指定用户对设备的访问权限。

#### mount的参数

|参数|描述|
|-|-|
|-a|挂载/etc/fstab文件中指定的所有文件系统|
|-f|使mount命令模拟挂载设备，但不是真的挂载|
|-F|和-a一起使用，同时挂载所有文件系统|
|-v|详细模式，会输出过程|
|-I|不启用任何/sbin/mount.filsystem下的文件系统帮助文件|
|-l|给ext2,ext3或XFS文件系统自动添加文件系统标签|
|-n|挂载设备，但不注册到/etc/mtab(记录当前已挂载的设备文件)|
|-p num|进行加密挂载时，从文件描述符num中获得密码断语|
|-s|忽略该文件系统不支持的挂载选项|
|-r|将该设备挂载为只读|
|-w|将该设备挂载为可读写(默认)|
|-L lable|将设备按指定的label挂载|
|-U uuid|将设备按指定的uuid|
|-O|限制命令只作用到特定的一组文件系统上|
|-o|给文件系统添加特定的选项|

#### -o的额外选项

|选项|含义|
|-|-|
|ro|以只读方式挂载|
|rw|以读写方式挂载|
|user|允许普通用户挂载文件系统|
|check=none|挂载文件时不进行完整性校验|
|loop|挂载一个文件|

### umount

- 支持通过设备文件或者挂载点指定要卸载的设备，若有程序正在使用设备文件则不能卸载。
- 可以使用lsof 设备名/挂载点 查看正在使用的进程名称

### df

- 查看所有已挂载磁盘的使用情况
- df显示的是linux认为的当前值，若有进程已创建或删除某个文件但并未释放，该值不会算入闲置空间。
- 会显示每个**有数据的已挂载文件系统**
  - 设备的文件位置
  - 能容纳的字节块(1024B)
  - 已使用的字节块
  - 还有多少字节块可使用
  - 已使用空间所占的比例
  - 设备的挂载点

#### df的参数

|选项|含义|
|-|-|
|-h|将原本的字节块大小改为使用实际大小表示如(M,G)|

### du

- 显示某个特定目录(默认当前目录)的磁盘使用情况，可用来判断该目录是否有超大文件。
- 默认情况，会显示当前目录下的所有文件，目录和子目录的磁盘使用情况，会以磁盘块为单位来表明每个文件或目录占用了多大存储空间。
- 每行输出左边的数值是每个文件夹或目录占用的磁盘块数(默认为1KB)。该列表是从目录层级的最底层开始，然后按文件，子目录，目录逐级向上。

#### du的参数

|参数|描述|
|-|-|
|-c|显示所有已列出文件总的大小|
|-h|按用户易读的格式输出如(K,M,G)|
|-s|显示每个输出参数的总计|

## 处理数据文件

### sort

- 默认按照会话指定的默认语言的排序规则对文本文件中的数据进行排序。
- 默认会将数字当作字符来执行标准的字符排序。
- 默认会将大写字母排在前面。
- 默认升序。

#### sort的参数

|参数|描述|
|-|-|
|-b|排序时忽略起始的空白|
|-C|不排序，如果数据无序也不报告|
|-c|不排序，检测是否有序，若无序则报告|
|-d|仅考虑空白和字符，不考虑特殊字符|
|-f|忽略大小写|
|-g|按通用数值来排序，将值当作浮点数排序，支持科学计数法|
|-i|排序时忽略不可打印字符|
|-k a,b|排序从a字段开始(从哪一列开始排序)，可以使用c.a,c.b来实现从c字段的第a个字符到c字段第b个字符开始排序|
|-M|用三字符月份名按月份排序|
|-m|将两个一排序数据文件合并，合并之后再次排序|
|-n|按字符串数值来排序，不会转化为浮点数|
|-o|将排序的结果写出到指定的文件中|
|-R file|默认按随机生成的散列表的键值排序，可以指定随机字节的源文件|
|-r|反序排列，降序|
|-S num|指定使用的内存大小|
|-s|禁用最后重排序比较|
|-T dir|指定一个位置来存储临时工作文件|
|-t|指定字段间隔符|
|-u|和-c一起使用会检查严格排序，去除重复行|
|-z|用NULL字符作为行尾代替换行符|

### grep

- grep [options] pattern [file]
- grep命令会在输入或指定文件中查找包含匹配指定模式的字符的行。
- 拓展命令egrep支持POSIX扩展正则表达式,fgrep支持将匹配模式指定为用换行符分隔的一列固定长度的字符串(批量匹配，匹配规则文件)。
- grep -r "strings" 目录，在当前目录下遍历所有文件，查找包含所选字符串的文件以及内容

#### grep的参数

|参数|描述|
|-|-|
|-v|反向搜索，输出不匹配该模式的行|
|-n|显示匹配模式的行所在的行号|
|-c|输出含有匹配的行数|
|-e|指定多种匹配模式，比如-e a -e b,输出匹配a或匹配b的结果|

### gzip

- linux上的压缩工具
  - bzip2(.bz2)
  - compress(.Z)
  - gzip(.gz)
  - zip(.zip)
- gzip的工具
  - gzip: 压缩文件
  - gzcat: 查看压缩过的文本文件的内容
  - gunzip: 用来解压文件
- gzip可以指定多个文件名以及用通配符批量压缩文件

### tar

- tar -cvf a.tar dir/list 创建归档文件
- tar -tf a.tar列出该归档文件的内容，但不提取文件
- tar -xvf a.tar从归档文件中提取文件
- .tgz是gzip压缩过的tar文件，可以用-zxvf解压

#### tar的参数

|参数|描述|
|-|-|
|-A|将一个已有tar归档文件追加到另一个已有tar归档文件中|
|-c|创建一个新的tar归档文件|
|-d|查看归档文件和文件系统的不同之处|
|-r|追加文件到已有tar归档文件末尾|
|-t|列出已有tar归档文件的内容|
|-u|将比tar归档文件中已有的同名文件新的文件追加到该tar归档文件中，更新内容|
|-x|从已有的归档文件中提起文件|
|-C dir|切换到指定目录|
|-f file|输出结果到文件或设备file|
|-j|将输出重定向给bzip2命令来压缩内容|
|-p|保留所有文件权限|
|-v|处理文件时显示文件|
|-z|将输出重定向给gzip命令来压缩文件|
