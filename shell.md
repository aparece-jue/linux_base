# shell

- [shell](#shell)
  - [shell的类型](#shell的类型)
  - [shell的父子关系](#shell的父子关系)
    - [bash的参数及描述](#bash的参数及描述)
    - [进程列表](#进程列表)
    - [后台模式](#后台模式)
    - [协程](#协程)
  - [shell的内建命令](#shell的内建命令)
    - [外部命令](#外部命令)
    - [内建命令](#内建命令)

## shell的类型

- 默认的shell在用户登陆某个虚拟控制台终端或在GUI中运行终端仿真器时启动。
- sh也是一个默认shell,用于需要在启动时使用的shell脚本。
- 每个不同的shell的语法要求不同

## shell的父子关系

- 用于登陆某个虚拟控制器终端或在GUI中运行终端仿真器所启动的默认的交互shell是一个父shell。
- 在CLI提示符后输入其他bash等其他等效的shell命令会创建新的shell程序，称为子shell。
- 生成子shell时，只有部分父进程的环境被复制到子shell环境中。
- 子shell可以从父shell中创建，也可以从另一个子shell创建。
- 可以使用exit退出当前shell。
- 运行shell脚本也能创建子shell。

### bash的参数及描述

|参数|描述|
|-|-|
|-c string|从string中读取命令并进行处理|
|-i|启动一个能够接受用户输入的交互shell|
|-l|以登陆shell的形式启动，执行只有在登陆时才会执行的操作。|
|-r|启动一个受限shell,用户会被限制在默认目录中|
|-s|从标准输入中读取命令|

### 进程列表

- 通过命令列表(在命令之间加入;)可以实现在一行中指定要依次执行的一系列命令。
- 将命令列表中的命令放在()中，会成为进程列表。会生成一个子shell用来执行对于的shell.
- 进程列表是一种命令分组，另一种命令分组是将命令放在{}中并在命令列表尾部加上;。语法为{command;}。使用{}进行命令分组并不会像进程列表一样创建子shell。
- $BASH_SUBSHELL在Bash中用来表示当前子shell的级别或深度。若为0表示没有子shell，否则存在子shell。$BASH_SUBSHELL只会在嵌套的子shell中递增，并且主要用于跟踪在子shell内部的层级或深度。
- 调用子shell可进行多进程处理，但代价高，会明显拖慢处理速度。交互式shell中子shell并非真正的多进程管理，因为终端控制着子shell的输入输出。

### 后台模式

- 在后台模式中运行命令可以让出CLI。
- 要将命令置入后台模式，可以在命令末尾加上字符&。会输出后台作业号和后台作业的进程id。
- jobs命令可以显示当前运行在后台模式中的所有用户的进程包括协程。会列出进程号，当前状态，进程名。jobs -l可以额外输出pid。
- 后台作业的结束状态看后台作业是否运行结束。
- 可以将进程列表置入后台模式。
- 可使用Ctrl+z将进程挂起，停止执行，使用bg +作业号如%1，将挂起的进程切换到后台执行，使用fg +作业号将其从后台换回前台

### 协程

- 协程会在后台生成一个子shell,并在子shell中执行命令。
- 使用coproc command,会创建子shell，并给该进程取协程名,将命令置于后台模式。
- coproc name { command; }
- 协程可以发送或接受来自子shell中进程的信息，只有在拥有多个协程的时候才需要对协程命名来通信。

## shell的内建命令

### 外部命令

- 外部命令又称文件系统命令，是存在与shell之外的程序。并不是shell程序的一部分，外部命令通常位于/bin,/usr/bin,/sbin或/usr/sbin中
- 外部命令执行时，会创建一个子进程。这种操作成为**衍生**。
- 进程必须执行衍生操作时，需要花费资源设置新子进程的环境。
- 衍生出子进程或创建子shell,仍可通过发送信号与其沟通。

### 内建命令

- 内建命令和外部命令的区别在于前者不需要使用子进程来执行。
- 和shell编译成一体，作为shell工具的组成部分存在，不需要借助外部程序文件来执行。
- 内建指令既不需要衍生出子shell执行，也不需要打开程序文件，内建命令的执行速度更快，效率更高。
- type -a可以显示每条命令的实现方式。内建命令，外部命令调用。
- history会跟踪使用过的命令，可以唤回这些命令并重新使用。
  - 可以设置HISTSIZE来修改保存的历史记录数量。
  - 可以唤回并重用历史列表中最近的命令。
  - 命令历史记录被保存在.(shell)_history位于用户的主目录，bash命令的历史记录是先存放在内存中，shell退出后才被写入到历史文件中。
  - history -a 强制写入当前历史记录。
  - 对于其他已打开的shell,并不会同时更新历史记录。因为.(shell)_history只在打开首个终端时才会被读取，强制重新读取并更新终端会话历史记录需使用history -n
  - 使用!(n)取第n行命令重新执行
- alias给常用命令以及参数取别名。
  - alias a='b'a为b的别名
  - 命令别名属于内部命令，一个别名竟在它被定义的shell进程中有效。
